# Readme

This folder holds a CMakeLists that defines `c2rust` bindings used for Rust unit tests and micro benchmarks. 
`c2rust` is a static library that will be linked to the crate `redis_mock`. This crate combines
the static c-symbols from `c2rust` with mock function for the [Redis Module API](https://redis.io/docs/latest/develop/reference/modules/modules-api-ref/) 
and is compiled as a dynamic library to be linked against Rust unit test and benchmark binaries.

For C++ tests the file [`redismock.cpp`](../../tests/cpptests/redismock/redismock.cpp) is used to define a mock of the redis module functions.

## Why do we need this

The build command `./build.sh FORCE DEBUG COV=1 RUN_RUST_TESTS` ends with unresolved symbols. The reason is not 100% clear, but we use `cargo +nightly llvm-cov` in this case.

This problem only arises on Linux systems.

## Unresolved Symbols

- RedisModule_GetSelectedDb
- RedisModule_SelectDb
- RedisModule_KeyExists
- RedisModule_OpenKey
- RedisModule_GetOpenKeyModesAll
- RedisModule_CloseKey
- RedisModule_KeyType
- RedisModule_ValueLength
- RedisModule_ListPush
- RedisModule_ListPop
- RedisModule_ListGet
- RedisModule_ListSet
- RedisModule_ListInsert
- RedisModule_ListDelete
- RedisModule_StringToDouble
- RedisModule_StringToLongDouble
- RedisModule_StringToStreamID
- RedisModule_Call
- RedisModule_CallReplyProto
- RedisModule_FreeCallReply
- RedisModule_CallReplyInteger
- RedisModule_CallReplyDouble
- RedisModule_CallReplyBool
- RedisModule_CallReplyBigNumber
- RedisModule_CallReplyVerbatim
- RedisModule_CallReplySetElement
- RedisModule_CallReplyMapElement
- RedisModule_CallReplyAttributeElement
- RedisModule_CallReplyPromiseSetUnblockHandler
- RedisModule_CallReplyPromiseAbort
- RedisModule_CallReplyAttribute
- RedisModule_CallReplyType
- RedisModule_CallReplyLength
- RedisModule_CallReplyArrayElement
- RedisModule_CallReplyStringPtr
- RedisModule_CreateStringFromCallReply
- RedisModule_CreateString
- RedisModule_CreateStringFromLongLong
- RedisModule_CreateStringFromULongLong
- RedisModule_CreateStringFromDouble
- RedisModule_CreateStringFromLongDouble
- RedisModule_CreateStringFromString
- RedisModule_CreateStringFromStreamID
- RedisModule_CreateStringPrintf
- RedisModule_StringPtrLen
- RedisModule_AutoMemory
- RedisModule_Replicate
- RedisModule_ReplicateVerbatim
- RedisModule_DeleteKey
- RedisModule_UnlinkKey
- RedisModule_StringSet
- RedisModule_StringDMA
- RedisModule_StringTruncate
- RedisModule_GetExpire
- RedisModule_SetExpire
- RedisModule_GetAbsExpire
- RedisModule_SetAbsExpire
- RedisModule_ResetDataset
- RedisModule_DbSize
- RedisModule_RandomKey
- RedisModule_ZsetAdd
- RedisModule_ZsetIncrby
- RedisModule_ZsetScore
- RedisModule_ZsetRem
- RedisModule_ZsetRangeStop
- RedisModule_ZsetFirstInScoreRange
- RedisModule_ZsetLastInScoreRange
- RedisModule_ZsetFirstInLexRange
- RedisModule_ZsetLastInLexRange
- RedisModule_ZsetRangeCurrentElement
- RedisModule_ZsetRangeNext
- RedisModule_ZsetRangePrev
- RedisModule_ZsetRangeEndReached
- RedisModule_HashSet
- RedisModule_HashGet
- RedisModule_HashFieldMinExpire
- RedisModule_StreamAdd
- RedisModule_StreamDelete
- RedisModule_StreamIteratorStart
- RedisModule_StreamIteratorStop
- RedisModule_StreamIteratorNextID
- RedisModule_StreamIteratorNextField
- RedisModule_StreamIteratorDelete
- RedisModule_StreamTrimByLength
- RedisModule_StreamTrimByID
- RedisModule_IsKeysPositionRequest
- RedisModule_KeyAtPos
- RedisModule_KeyAtPosWithFlags
- RedisModule_IsChannelsPositionRequest
- RedisModule_ChannelAtPosWithFlags
- RedisModule_GetClientId
- RedisModule_GetClientUserNameById
- RedisModule_GetContextFlags
- RedisModule_AvoidReplicaTraffic
- RedisModule_PoolAlloc
- RedisModule_CreateDataType
- RedisModule_ModuleTypeSetValue
- RedisModule_ModuleTypeReplaceValue
- RedisModule_ModuleTypeGetType
- RedisModule_ModuleTypeGetValue
- RedisModule_IsIOError
- RedisModule_SetModuleOptions
- RedisModule_SignalModifiedKey
- RedisModule_SaveUnsigned
- RedisModule_LoadUnsigned
- RedisModule_SaveSigned
- RedisModule_LoadSigned
- RedisModule_SaveString
- RedisModule_SaveStringBuffer
- RedisModule_LoadString
- RedisModule_LoadStringBuffer
- RedisModule_SaveDouble
- RedisModule_LoadDouble
- RedisModule_SaveFloat
- RedisModule_LoadFloat
- RedisModule_SaveLongDouble
- RedisModule_LoadLongDouble
- RedisModule_SaveDataTypeToString
- RedisModule_LoadDataTypeFromString
- RedisModule_LoadDataTypeFromStringEncver
- RedisModule_EmitAOF
- RedisModule_Log
- RedisModule_LogIOError
- RedisModule__Assert
- RedisModule_LatencyAddSample
- RedisModule_StringAppendBuffer
- RedisModule_TrimStringAllocation
- RedisModule_RetainString
- RedisModule_HoldString
- RedisModule_StringCompare
- RedisModule_GetContextFromIO
- RedisModule_GetKeyNameFromIO
- RedisModule_GetKeyNameFromModuleKey
- RedisModule_GetDbIdFromModuleKey
- RedisModule_GetDbIdFromIO
- RedisModule_GetKeyNameFromOptCtx
- RedisModule_GetToKeyNameFromOptCtx
- RedisModule_GetDbIdFromOptCtx
- RedisModule_GetToDbIdFromOptCtx
- RedisModule_Milliseconds
- RedisModule_MonotonicMicroseconds
- RedisModule_Microseconds
- RedisModule_CachedMicroseconds
- RedisModule_DigestAddStringBuffer
- RedisModule_DigestAddLongLong
- RedisModule_DigestEndSequence
- RedisModule_GetKeyNameFromDigest
- RedisModule_GetDbIdFromDigest
- RedisModule_CreateDict
- RedisModule_FreeDict
- RedisModule_DictSize
- RedisModule_DictSetC
- RedisModule_DictReplaceC
- RedisModule_DictSet
- RedisModule_DictReplace
- RedisModule_DictGetC
- RedisModule_DictGet
- RedisModule_DictDelC
- RedisModule_DictDel
- RedisModule_DictIteratorStartC
- RedisModule_DictIteratorStart
- RedisModule_DictIteratorStop
- RedisModule_DictIteratorReseekC
- RedisModule_DictIteratorReseek
- RedisModule_DictNextC
- RedisModule_DictPrevC
- RedisModule_DictNext
- RedisModule_DictPrev
- RedisModule_DictCompare
- RedisModule_DictCompareC
- RedisModule_RegisterInfoFunc
- RedisModule_RegisterAuthCallback
- RedisModule_InfoAddSection
- RedisModule_InfoBeginDictField
- RedisModule_InfoEndDictField
- RedisModule_InfoAddFieldString
- RedisModule_InfoAddFieldCString
- RedisModule_InfoAddFieldDouble
- RedisModule_InfoAddFieldLongLong
- RedisModule_InfoAddFieldULongLong
- RedisModule_GetServerInfo
- RedisModule_FreeServerInfo
- RedisModule_ServerInfoGetField
- RedisModule_ServerInfoGetFieldC
- RedisModule_ServerInfoGetFieldSigned
- RedisModule_ServerInfoGetFieldUnsigned
- RedisModule_ServerInfoGetFieldDouble
- RedisModule_GetClientInfoById
- RedisModule_GetClientNameById
- RedisModule_SetClientNameById
- RedisModule_PublishMessage
- RedisModule_PublishMessageShard
- RedisModule_SubscribeToServerEvent
- RedisModule_SetLRU
- RedisModule_GetLRU
- RedisModule_SetLFU
- RedisModule_GetLFU
- RedisModule_BlockClientOnKeys
- RedisModule_BlockClientOnKeysWithFlags
- RedisModule_SignalKeyAsReady
- RedisModule_GetBlockedClientReadyKey
- RedisModule_ScanCursorCreate
- RedisModule_ScanCursorRestart
- RedisModule_ScanCursorDestroy
- RedisModule_Scan
- RedisModule_ScanKey
- RedisModule_GetContextFlagsAll
- RedisModule_GetModuleOptionsAll
- RedisModule_GetKeyspaceNotificationFlagsAll
- RedisModule_IsSubEventSupported
- RedisModule_GetServerVersion
- RedisModule_GetTypeMethodVersion
- RedisModule_Yield
- RedisModule_GetThreadSafeContext
- RedisModule_GetDetachedThreadSafeContext
- RedisModule_FreeThreadSafeContext
- RedisModule_ThreadSafeContextLock
- RedisModule_ThreadSafeContextTryLock
- RedisModule_ThreadSafeContextUnlock
- RedisModule_BlockClient
- RedisModule_BlockClientGetPrivateData
- RedisModule_BlockClientSetPrivateData
- RedisModule_BlockClientOnAuth
- RedisModule_UnblockClient
- RedisModule_IsBlockedReplyRequest
- RedisModule_IsBlockedTimeoutRequest
- RedisModule_GetBlockedClientPrivateData
- RedisModule_GetBlockedClientHandle
- RedisModule_AbortBlock
- RedisModule_BlockedClientMeasureTimeStart
- RedisModule_BlockedClientMeasureTimeEnd
- RedisModule_SetDisconnectCallback
- RedisModule_SubscribeToKeyspaceEvents
- RedisModule_AddPostNotificationJob
- RedisModule_NotifyKeyspaceEvent
- RedisModule_GetNotifyKeyspaceEvents
- RedisModule_BlockedClientDisconnected
- RedisModule_RegisterClusterMessageReceiver
- RedisModule_SendClusterMessage
- RedisModule_GetClusterNodeInfo
- RedisModule_GetClusterNodesList
- RedisModule_FreeClusterNodesList
- RedisModule_CreateTimer
- RedisModule_StopTimer
- RedisModule_GetTimerInfo
- RedisModule_GetMyClusterID
- RedisModule_GetClusterSize
- RedisModule_GetRandomBytes
- RedisModule_GetRandomHexChars
- RedisModule_SetClusterFlags
- RedisModule_ClusterKeySlot
- RedisModule_ClusterCanonicalKeyNameInSlot
- RedisModule_ExportSharedAPI
- RedisModule_GetSharedAPI
- RedisModule_RegisterCommandFilter
- RedisModule_UnregisterCommandFilter
- RedisModule_CommandFilterArgsCount
- RedisModule_CommandFilterArgGet
- RedisModule_CommandFilterArgInsert
- RedisModule_CommandFilterArgReplace
- RedisModule_CommandFilterArgDelete
- RedisModule_CommandFilterGetClientId
- RedisModule_Fork
- RedisModule_SendChildHeartbeat
- RedisModule_ExitFromChild
- RedisModule_KillForkChild
- RedisModule_GetUsedMemoryRatio
- RedisModule_MallocSize
- RedisModule_MallocUsableSize
- RedisModule_MallocSizeString
- RedisModule_MallocSizeDict
- RedisModule_CreateModuleUser
- RedisModule_FreeModuleUser
- RedisModule_SetContextUser
- RedisModule_SetModuleUserACL
- RedisModule_SetModuleUserACLString
- RedisModule_GetModuleUserACLString
- RedisModule_GetCurrentUserName
- RedisModule_GetModuleUserFromUserName
- RedisModule_ACLCheckCommandPermissions
- RedisModule_ACLCheckKeyPermissions
- RedisModule_ACLCheckKeyPrefixPermissions
- RedisModule_ACLCheckChannelPermissions
- RedisModule_ACLAddLogEntry
- RedisModule_ACLAddLogEntryByUserName
- RedisModule_DeauthenticateAndCloseClient
- RedisModule_AuthenticateClientWithACLUser
- RedisModule_AuthenticateClientWithUser
- RedisModule_RedactClientCommandArgument
- RedisModule_GetClientCertificate
- RedisModule_GetCommandKeys
- RedisModule_GetCommandKeysWithFlags
- RedisModule_GetCurrentCommandName
- RedisModule_RegisterDefragFunc
- RedisModule_RegisterDefragCallbacks
- RedisModule_DefragAlloc
- RedisModule_DefragAllocRaw
- RedisModule_DefragFreeRaw
- RedisModule_DefragRedisModuleString
- RedisModule_DefragShouldStop
- RedisModule_DefragCursorSet
- RedisModule_DefragCursorGet
- RedisModule_GetKeyNameFromDefragCtx
- RedisModule_GetDbIdFromDefragCtx
- RedisModule_EventLoopAdd
- RedisModule_EventLoopDel
- RedisModule_EventLoopAddOneShot
- RedisModule_RegisterBoolConfig
- RedisModule_RegisterNumericConfig
- RedisModule_RegisterStringConfig
- RedisModule_RegisterEnumConfig
- RedisModule_LoadConfigs
- RedisModule_LoadDefaultConfigs
- RedisModule_RdbStreamCreateFromFile
- RedisModule_RdbStreamFree
- RedisModule_RdbLoad
- RedisModule_RdbSave
- RedisModule_GetInternalSecret
- RedisModule_ShardingGetKeySlot
- RedisModule_ShardingGetSlotRange
- RedisModule_SetDataTypeExtensions
- RedisModule_SwapPrefetchKey
- RedisModule_GetSwapKeyMetadata
- RedisModule_SetSwapKeyMetadata
- RedisModule_IsKeyInRam
- fast_float_strtod
- nu_tolower
- nu_strtransformnlen
- nu_utf8_write
- nu_bytenlen
- nu_writenstr
- RediSearch_ExportCapi
- GetJSONAPIs
- RediSearch_LockInit
- Extensions_Init
- Indexes_Init
- GC_ThreadPoolStart
- CleanPool_ThreadPoolStart
- g_CursorsList
- CursorList_Init
- g_CursorsListCoord
- workersThreadPool_CreatePool
- IndexAlias_InitGlobal
- RegisterAllFunctions
- Extension_LoadDynamic
- DefaultExtensionInit
- Extension_Load
- RS_moduleInfoFunc
- Initialize_ServerEventNotifications
- Initialize_CommandFilter
- Initialize_RdbNotifications
- Initialize_RoleChangeNotifications
- VecSim_SetMemoryFunctions
- VecSim_SetTimeoutCallbackFunction
- VecSimLogCallback
- VecSim_SetLogCallbackFunction
- __gcov_init
- __gcov_exit
- __gcov_merge_add
- QueryError_SetWithUserDataFmt
- RedisModule_Reply_StringBuffer
- RedisModule_Reply_String
- RedisModule_Reply_Double
- RedisModule_Reply_Error
- RedisModule_Reply_LongLong
- RedisModule_Reply_Null
- RedisModule_Reply_Array
- RedisModule_Reply_ArrayEnd
- RedisModule_Reply_Map
- RedisModule_Reply_MapEnd
- sdscat
- Obfuscate_Text
- sdscatfmt
- sdscatlen
- Obfuscate_Number
- AC_GetString
- QueryError_SetError
- sdsnew
- config_ext_load
- AC_GetLongLong
- sdsempty
- sdscatprintf
- AC_GetUnsigned
- QueryError_SetWithoutUserDataFmt
- AC_GetSize
- workersThreadPool_SetNumWorkers
- AC_GetU8
- AC_GetU32
- config_friso_ini
- AC_GetInt
- NewHiddenString
- legacySpecRules
- dictFetchValue
- HiddenString_Free
- AC_ParseArgSpec
- dictAdd
- AC_GetStringNC
- QueryError_GetUserError
- QueryError_ClearError
- RedisModule_Reply_SimpleString
- RedisModule_ReplyKV_SimpleString
- IsEnterprise
