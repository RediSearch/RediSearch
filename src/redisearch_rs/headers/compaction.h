#pragma once

/* Warning, this file is autogenerated by cbindgen from `src/redisearch_rs/c_entrypoint/compaction_ffi/build.rs`. Don't modify it manually. */

#include <stdarg.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
#include <stdint.h>

/**
 * Scoring stats delta - passed to the update callback.
 *
 * This structure is FFI-safe and the C definition is auto-generated by cbindgen.
 * It only contains stats that are updated by GC, NOT at delete time.
 *
 * Note: `num_docs` and `totalDocsLen` are updated at delete time,
 * so they are NOT included here.
 */
typedef struct SearchDisk_ScoringStatsDelta {
  /**
   * Number of terms that became empty during compaction.
   */
  uint64_t num_terms_removed;
} SearchDisk_ScoringStatsDelta;

/**
 * FFI-safe callback struct for compaction operations.
 *
 * This struct is passed from C to Rust. Rust invokes these callbacks to
 * perform operations on C-owned data structures.
 *
 * The C definition is auto-generated by cbindgen.
 *
 * # Safety
 *
 * All function pointers must be valid and the `ctx` pointer must remain
 * valid for the duration of compaction. The C side is responsible for
 * providing valid callback implementations.
 */
typedef struct SearchDisk_CompactionCallbacks {
  /**
   * Acquire IndexSpec write lock.
   * Called before applying delta to memory structures.
   */
  void (*acquire_write_lock)(void*);
  /**
   * Release IndexSpec write lock.
   * Called after applying delta to memory structures.
   */
  void (*release_write_lock)(void*);
  /**
   * Update a term's document count in the Serving Trie.
   *
   * # Parameters
   * - `ctx`: Opaque context pointer (typically IndexSpec*)
   * - `term`: Pointer to term string (NOT null-terminated)
   * - `term_len`: Length of term in bytes
   * - `doc_count_decrement`: Number of documents to decrement from the term's count
   */
  void (*update_trie_term)(void*, const char*, uintptr_t, uintptr_t);
  /**
   * Update IndexScoringStats.
   *
   * # Parameters
   * - `ctx`: Opaque context pointer (typically IndexSpec*)
   * - `delta`: Pointer to ScoringStatsDelta with the changes
   */
  void (*update_scoring_stats)(void*, const struct SearchDisk_ScoringStatsDelta*);
  /**
   * Opaque pointer passed to all callbacks.
   * Typically points to the C IndexSpec struct.
   */
  void *ctx;
} SearchDisk_CompactionCallbacks;
