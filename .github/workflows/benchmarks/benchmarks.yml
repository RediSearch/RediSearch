name: Run RediSearch Benchmarks

on:
  workflow_call:

jobs:
  benchmark-search-oss-standalone:
    strategy:
      matrix:
        member_id: [1, 2, 3]
    uses: ./.github/workflows/benchmarks/run-benchmark.yml
    secrets: inherit
    with:
      benchmark_glob: "search*.yml"
      benchmark_runner_group_member_id: ${{ matrix.member_id }}
      benchmark_runner_group_total: ${{ strategy.job-total }}

  benchmark-vecsim-oss-standalone:
    strategy:
      matrix:
        member_id: [1, 2]
    uses: ./.github/workflows/benchmarks/run-benchmark.yml
    secrets: inherit
    with:
      benchmark_glob: "vecsim*.yml"
      benchmark_runner_group_member_id: ${{ matrix.member_id }}
      benchmark_runner_group_total: ${{ strategy.job-total }}

  benchmark-search-oss-cluster-02-primaries:
    strategy:
      matrix:
        member_id: [1, 2]
    uses: ./.github/workflows/benchmarks/run-benchmark.yml
    secrets: inherit
    with:
      cluster_env: 1
      benchmark_glob: "search*.yml"
      module_path: bin/linux-x64-release/coord-oss/module-oss.so
      allowed_envs: oss-cluster
      allowed_setups: oss-cluster-02-primaries
      benchmark_runner_group_member_id: ${{ matrix.member_id }}
      benchmark_runner_group_total: ${{ strategy.job-total }}

  benchmark-search-oss-cluster-04-primaries:
    strategy:
      matrix:
        member_id: [1, 2]
    uses: ./.github/workflows/benchmarks/run-benchmark.yml
    secrets: inherit
    with:
      cluster_env: 1
      benchmark_glob: "search*.yml"
      module_path: bin/linux-x64-release/coord-oss/module-oss.so
      allowed_envs: oss-cluster
      allowed_setups: oss-cluster-04-primaries
      benchmark_runner_group_member_id: ${{ matrix.member_id }}
      benchmark_runner_group_total: ${{ strategy.job-total }}

  benchmark-search-oss-cluster-08-primaries:
    strategy:
      matrix:
        member_id: [1, 2, 3]
    uses: ./.github/workflows/benchmarks/run-benchmark.yml
    secrets: inherit
    with:
      cluster_env: 1
      benchmark_glob: "search*.yml"
      module_path: bin/linux-x64-release/coord-oss/module-oss.so
      allowed_envs: oss-cluster
      allowed_setups: oss-cluster-08-primaries
      benchmark_runner_group_member_id: ${{ matrix.member_id }}
      benchmark_runner_group_total: ${{ strategy.job-total }}

  benchmark-search-oss-cluster-16-primaries:
    strategy:
      matrix:
        member_id: [1, 2, 3]
    uses: ./.github/workflows/benchmarks/run-benchmark.yml
    secrets: inherit
    with:
      cluster_env: 1
      benchmark_glob: "search*.yml"
      module_path: bin/linux-x64-release/coord-oss/module-oss.so
      allowed_envs: oss-cluster
      allowed_setups: oss-cluster-16-primaries
      benchmark_runner_group_member_id: ${{ matrix.member_id }}
      benchmark_runner_group_total: ${{ strategy.job-total }}


  benchmark-search-oss-cluster-20-primaries:
    strategy:
      matrix:
        member_id: [1]
    uses: ./.github/workflows/benchmarks/run-benchmark.yml
    secrets: inherit
    with:
      cluster_env: 1
      benchmark_glob: "search*.yml"
      module_path: bin/linux-x64-release/coord-oss/module-oss.so
      allowed_envs: oss-cluster
      allowed_setups: oss-cluster-20-primaries
      benchmark_runner_group_member_id: ${{ matrix.member_id }}
      benchmark_runner_group_total: ${{ strategy.job-total }}


  benchmark-search-oss-cluster-24-primaries:
    strategy:
      matrix:
        member_id: [1]
    uses: ./.github/workflows/benchmarks/run-benchmark.yml
    secrets: inherit
    with:
      cluster_env: 1
      benchmark_glob: "search*.yml"
      module_path: bin/linux-x64-release/coord-oss/module-oss.so
      allowed_envs: oss-cluster
      allowed_setups: oss-cluster-24-primaries
      benchmark_runner_group_member_id: ${{ matrix.member_id }}
      benchmark_runner_group_total: ${{ strategy.job-total }}

  benchmark-search-oss-standalone-profiler:
    strategy:
      matrix:
        member_id: [1, 2, 3]
    uses: ./.github/workflows/benchmarks/run-benchmark.yml
    secrets: inherit
    with:
      profile_env: 1
      triggering_env: "github-actions.profilers" # results generated with profilers attached are not mixed with the ones without it
      module_path: bin/linux-x64-release-profile/search/redisearch.so
      benchmark_glob: "search*.yml"
      benchmark_runner_group_member_id: ${{ matrix.member_id }}
      benchmark_runner_group_total: ${{ strategy.job-total }}


  benchmark-vecsim-oss-standalone-profiler:
    strategy:
      matrix:
        member_id: [1, 2]
    uses: ./.github/workflows/benchmarks/run-benchmark.yml
    secrets: inherit
    with:
      profile_env: 1
      triggering_env: "github-actions.profilers" # results generated with profilers attached are not mixed with the ones without it
      module_path: bin/linux-x64-release-profile/search/redisearch.so
      benchmark_glob: "vecsim*.yml"
      benchmark_runner_group_member_id: ${{ matrix.member_id }}
      benchmark_runner_group_total: ${{ strategy.job-total }}
