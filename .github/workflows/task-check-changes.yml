on:
  workflow_call:
    inputs:
      env:
        default: "${{ vars.RUNS_ON }} || ubuntu-latest"
        type: string
    outputs:
      BENCHMARK_NEEDED:
        description: "Indicates if benchmark-related files were modified"
        value: ${{ jobs.benchmark-needed-checks.outputs.BENCHMARK_NEEDED }}
      MICRO_BENCHMARK_NEEDED:
        description: "Indicates if Rust micro-benchmark files were modified"
        value: ${{ jobs.benchmark-needed-checks.outputs.MICRO_BENCHMARK_NEEDED }}

jobs: 
  benchmark-needed-checks:
    runs-on: ${{ vars.RUNS_ON || 'ubuntu-latest' }}
    outputs:
      BENCHMARK_NEEDED: ${{ steps.check-benchmarks.outputs.any_modified }}
      MICRO_BENCHMARK_NEEDED: ${{ steps.check-micro-benchmarks.outputs.any_modified }}
    steps:
      - name: Checkout
        uses: actions/checkout@
        with:
          fetch-depth: 0 # required for changed-files action to work
        
      - name: Check if benchmarks or code were changed
        id: check-benchmarks
        uses: tj-actions/changed-files@
        with: # Only run on changes to these paths (code, deps, and benchmarks related changes)
          files: |
                src/**
                deps/**
                tests/benchmarks/**
                .github/workflows/benchmark-*.yml
                **/CMakeLists.txt
                **/Makefile
      - name: Check if rust micro-benchmarks were changed
        id: check-micro-benchmarks
        uses: tj-actions/changed-files@
        with: # Only run on changes to these paths (code, deps, and benchmarks related changes)
          files: |
              src/redisearch_rs/**
