name: Build on macOS

# Documentation: https://redislabs.atlassian.net/wiki/spaces/DX/pages/3967844669/RediSearch+CI+refactor

on:
  workflow_dispatch:
  workflow_call:
    inputs:
      test-config:
        description: 'Test configuration environment variable (e.g. "CONFIG=concurrent_write" or "QUICK=1")'
        type: string
      coordinator:
        type: boolean
        default: true
      standalone:
        type: boolean
        default: true

jobs:
  build-macos:
    strategy:
      fail-fast: false
      matrix:
        arch: [macos-11, macos-13-xlarge] # macos-13-xlarge has M1 chip
    uses: ./.github/workflows/common-flow-host.yml
    with:
      env: ${{ matrix.arch }}
      get-redis: true
      test-config: ${{ inputs.test-config || ''   }} # fallbacks for workflow_dispatch
      coordinator: ${{ inputs.coordinator || true }}
      standalone:  ${{ inputs.standalone  || true }}
    secrets: inherit
