name: Merge a pull request

# Documentation: https://redislabs.atlassian.net/wiki/spaces/DX/pages/3967844669/RediSearch+CI+refactor

on:
  merge_group:
    types: [checks_requested]

# TODO: use some action like dorny/paths-filter@v2 to skip validation if only docs were changed

jobs:
  verify:
    uses: ./.github/workflows/common-merge-and-nightly.yml
    secrets: inherit
    with:
      redis-ref: ${{ vars.DEFAULT_REDIS_REF }}
      json-ref: ${{ vars.DEFAULT_REDISJSON_REF }}

  pr-validation:
    needs: [verify]
    runs-on: ubuntu-latest
    if: ${{ !cancelled() }}
    steps:
      - if: contains(needs.*.result, 'failure')
        run: exit 1
