name: Merge a pull request

# Documentation: https://redislabs.atlassian.net/wiki/spaces/DX/pages/3967844669/RediSearch+CI+refactor

on:
  merge_group:
    types: [checks_requested]

concurrency:
  group: ${{ github.workflow }}-${{ github.sha }}
  cancel-in-progress: true

# TODO: Use RedisJSON's `${{ vars.DEFAULT_REDISJSON_REF }}` branch when testing on nightly

jobs:
  stall:
    runs-on: ubuntu-latest
    env:
      GH_CONTEXT: ${{ toJson(github) }}
      MERGE_GROUP: ${{ toJson(github.event.merge_group) }}
    steps:
      - run: sleep 60
      - run: exit 1

  pr-validation:
    needs: [test-linux, test-macos, coverage, sanitize]
    runs-on: ubuntu-latest
    if: ${{ !cancelled() }}
    steps:
      - if: contains(needs.*.result, 'failure')
        run: exit 1
