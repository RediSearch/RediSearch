name: Push to Master or Version Branch

# Documentation: https://redislabs.atlassian.net/wiki/spaces/DX/pages/3967844669/RediSearch+CI+refactor

on:
  push:
    branches:
      - master
      - '[0-9]+.[0-9]+'

jobs:
  check-what-is-needed:
    uses: ./.github/workflows/task-check-changes.yml

  benchmark:
    needs: check-what-is-needed
    if: ${{ needs.check-what-is-needed.outputs.BENCHMARK_NEEDED == 'true' }}
    uses: ./.github/workflows/benchmark-runner.yml
    secrets: inherit

  micro-benchmarks:
    needs: check-what-is-needed
    if: ${{ needs.check-what-is-needed.outputs.MICRO_BENCHMARK_NEEDED == 'true'}}
    uses: ./.github/workflows/flow-micro-benchmarks.yml
